{
  // See https://go.microsoft.com/fwlink/?LinkId=733558
  // for the documentation about the tasks.json format
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Build & Start Local Services",
      "dependsOn":[
        "Validate prerequisites",
        "Build Local Services",
        "Start Local Services"
      ],
      "dependsOrder": "sequence"
    },
    {
      "label": "Build Local Services",
      "dependsOn":[
        "Build AdditionApp",
        "Build SubtractionApp",
        "Build CalculatorApp Server",
        "Build CalculatorApp Client",
      ],
      "dependsOrder": "parallel"
    },
    {
      "label": "Start Local Services",
      "dependsOn":[
        "Start AdditionApp & Sidecar",
        "Start SubtractionApp & Sidecar",
        "Start CalculatorApp Server & Sidecar"
      ],
      "dependsOrder": "parallel"
    },
    {
      "label": "Validate prerequisites",
      "type": "shell",
      "command":[
        "echo",
        "placeholder"
      ]
    },
    {
      "label": "Build AdditionApp",
      "type": "shell",
      "command":[
        "npm", "install"
      ],
      "options": {
        "cwd": "${workspaceFolder}/src/node-addition"
      }
    },
    {
      "label": "Build SubtractionApp",
      "type": "shell",
      "command":[
        "echo", "nothing"
      ]
    },
    {
      "label": "Build CalculatorApp Server",
      "type": "shell",
      "command": [
        "npm", "install"
      ],
      "options": {
        "cwd": "${workspaceFolder}/src/react-calculator"
      }
    },
    {
      "label": "Build CalculatorApp Client",
      "type": "shell",
      "command":[
        "npm", "run", "buildclient"
      ],
      "options": {
        "cwd": "${workspaceFolder}/src/react-calculator"
      }
    },
    {
      "label": "Start AdditionApp & Sidecar",
      "dependsOn":[
        "Start Sidecar for AdditionApp",
        "Start AdditionApp"
      ],
      "dependsOrder": "parallel"
    },
    {
      "label": "Start SubtractionApp & Sidecar",
      "dependsOn":[
        "Start Sidecar for SubtractionApp",
        "Start SubtractionApp"
      ],
      "dependsOrder": "parallel"
    },
    {
      "label": "Start CalculatorApp Server & Sidecar",
      "dependsOn":[
        "Start CalculatorApp Server",
        "Start Sidecar for CalculatorApp"
      ],
      "dependsOrder": "parallel"
    },
    {
      "label": "Start CalculatorApp Server",
      "type": "shell",
      "isBackground": true,
      "command":[
        "npm", "run", "server"
      ],
      "options": {
        "cwd": "${workspaceFolder}/src/react-calculator"
      }
    },
    {
      "label": "Start Sidecar for AdditionApp",
      "type": "shell",
      "command": "dapr",
      "args": [
          "run",
          "--app-id", "additionapp",
          "--app-port", "4000",
          "--dapr-http-port", "3505"
      ],
      "isBackground": true
    },
    {
      "label": "Start AdditionApp",
      "type": "shell",
      "command":[
        "node", "app.js"
      ],
      "options": {
        "cwd": "${workspaceFolder}/src/node-addition"
      },
      "isBackground": true
    },
    {
      "label": "stop-sidecar-additionapp",
      "type": "shell",
      "command": "dapr",
      "args": [
          "stop",
          "--app-id", "additionapp"
      ],
      "problemMatcher": {
        "pattern": [
          {
              "regexp": "^.*$",
              "file": 0,
              "location": 1,
              "message": 2
          }
        ]
      }
    },
    {
      "label": "Start Sidecar for SubtractionApp",
      "type": "shell",
      "command": "dapr",
      "args": [
          "run",
          "--app-id", "subtractionapp",
          "--app-port", "5001",
          "--dapr-http-port", "3506"
      ],
      "isBackground": true,
      "problemMatcher": {
        "pattern": [
          {
              "regexp": "^.*$",
              "file": 0,
              "location": 1,
              "message": 2
          }
        ]
      }
    },
    {
      "label": "Start SubtractionApp",
      "type": "shell",
      "command":[
        "python", "app.py"
      ],
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/src/python-subtraction"
      }
    },
    {
      "label": "stop-sidecar-subtractionapp",
      "type": "shell",
      "command": "dapr",
      "args": [
          "stop",
          "--app-id", "subtractionapp"
      ],
      "problemMatcher": {
        "pattern": [
          {
              "regexp": "^.*$",
              "file": 0,
              "location": 1,
              "message": 2
          }
        ]
      }
    },
    {
      "label": "Start Sidecar for CalculatorApp",
      "type": "shell",
      "command": "dapr",
      "args": [
          "run",
          "--app-id", "calculatorapp",
          "--app-port", "8080",
          "--dapr-http-port", "3500"
      ],
      "isBackground": true,
      "dependsOn": [
        "build-calculatorapp-server",
        "build-calculatorapp-client"
      ],
      "problemMatcher": {
        "pattern": [
          {
              "regexp": "^.*$",
              "file": 0,
              "location": 1,
              "message": 2
          }
        ]
      }
    },
    {
      "label": "build-calculatorapp-server",
      "type": "shell",
      "command": "npm",
      "args": [
        "install"
      ],
      "options": {
        "cwd": "${workspaceFolder}\\src\\react-calculator"
      }
    },
    {
      "label": "build-calculatorapp-client",
      "type": "shell",
      "command": "npm",
      "args": [
        "run",
        "buildclient"
      ],
      "options": {
        "cwd": "${workspaceFolder}\\src\\react-calculator"
      }
    },
    {
      "label": "stop-sidecar-calculatorapp",
      "type": "shell",
      "command": "dapr",
      "args": [
          "stop",
          "--app-id", "calculatorapp"
      ],
      "problemMatcher": {
        "pattern": [
          {
              "regexp": "^.*$",
              "file": 0,
              "location": 1,
              "message": 2
          }
        ]
      }
    }
  ]
}